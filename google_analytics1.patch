From c6f4a87a6b38f262ae0b295465da4b683582d134 Mon Sep 17 00:00:00 2001
From: Koushik Dutta <koushd@gmail.com>
Date: Sun, 31 Mar 2013 14:41:18 -0700
Subject: [PATCH] Add Google Analytics support.

Change-Id: I81f816f2a358a36247c05a97053e948f4ea62753

Conflicts:
	Android.mk
---
 Android.mk                                             |    2 +-
 res/values/analytics.xml                               |   12 ++++++++++++
 src/com/android/settings/cmstats/ReportingService.java |   12 ++++++++++++
 3 files changed, 25 insertions(+), 1 deletion(-)
 create mode 100644 res/values/analytics.xml

diff --git a/Android.mk b/Android.mk
index 38732bb..5206231 100644
--- a/Android.mk
+++ b/Android.mk
@@ -2,7 +2,7 @@ LOCAL_PATH:= $(call my-dir)
 include $(CLEAR_VARS)
 
 LOCAL_JAVA_LIBRARIES := bouncycastle
-LOCAL_STATIC_JAVA_LIBRARIES := guava android-support-v4
+LOCAL_STATIC_JAVA_LIBRARIES := guava android-support-v4 libGoogleAnalyticsV2
 
 LOCAL_MODULE_TAGS := optional
 
diff --git a/res/values/analytics.xml b/res/values/analytics.xml
new file mode 100644
index 0000000..426591a
--- /dev/null
+++ b/res/values/analytics.xml
@@ -0,0 +1,12 @@
+<?xml version="1.0" encoding="utf-8" ?>
+
+<resources>
+  <!--Replace placeholder ID with your tracking ID-->
+  <string name="ga_trackingId">UA-39737599-1</string>
+
+  <!--Enable automatic activity tracking-->
+  <bool name="ga_autoActivityTracking">false</bool>
+
+  <!--Enable automatic exception tracking-->
+  <bool name="ga_reportUncaughtExceptions">false</bool>
+</resources>
\ No newline at end of file
diff --git a/src/com/android/settings/cmstats/ReportingService.java b/src/com/android/settings/cmstats/ReportingService.java
index 2a034e3..3c9cf33 100644
--- a/src/com/android/settings/cmstats/ReportingService.java
+++ b/src/com/android/settings/cmstats/ReportingService.java
@@ -39,6 +39,11 @@ import android.util.Log;
 import com.android.settings.R;
 import com.android.settings.Settings;
 
+import com.google.analytics.tracking.android.GoogleAnalytics;
+import com.google.analytics.tracking.android.Tracker;
+
+import com.android.settings.R;
+
 public class ReportingService extends Service {
     protected static final String TAG = "CMStats";
 
@@ -80,6 +85,13 @@ public class ReportingService extends Service {
         Log.d(TAG, "SERVICE: Carrier=" + deviceCarrier);
         Log.d(TAG, "SERVICE: Carrier ID=" + deviceCarrierId);
 
+        // report to google analytics
+        GoogleAnalytics ga = GoogleAnalytics.getInstance(this);
+        Tracker tracker = ga.getTracker(getString(R.string.ga_trackingId));
+        tracker.sendEvent(deviceName, deviceVersion, deviceCountry, null);
+        tracker.close();
+
+        // report to the cmstats service
         HttpClient httpclient = new DefaultHttpClient();
         HttpPost httppost = new HttpPost("http://stats.cyanogenmod.org/submit");
         try {
-- 
1.7.10.4

