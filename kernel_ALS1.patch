From ecd652eb609c322dec11c900552b4cee499b756f Mon Sep 17 00:00:00 2001
From: Alin Jerpelea <jerpelea@gmail.com>
Date: Fri, 29 Mar 2013 19:08:14 +0200
Subject: [PATCH] msm7x30: wait for backlight resume

Change-Id: I470c2ef062a0d6b5cf491b4724e31cae2303ed09
---
 arch/arm/mach-msm/board-semc_zeus.c |    3 ++-
 arch/arm/mach-msm/leds-akane.c      |    3 ++-
 arch/arm/mach-msm/leds-anzu.c       |    3 ++-
 arch/arm/mach-msm/leds-azusa.c      |    3 ++-
 arch/arm/mach-msm/leds-coconut.c    |    4 ++--
 arch/arm/mach-msm/leds-haida.c      |   10 +++++-----
 arch/arm/mach-msm/leds-hallon.c     |    9 +++++----
 arch/arm/mach-msm/leds-iyokan.c     |    5 ++---
 arch/arm/mach-msm/leds-mango.c      |    4 ++--
 arch/arm/mach-msm/leds-mogami_cdb.c |    3 ++-
 arch/arm/mach-msm/leds-satsuma.c    |    3 ++-
 arch/arm/mach-msm/leds-smultron.c   |    9 +++++----
 arch/arm/mach-msm/leds-urushi.c     |    3 ++-
 13 files changed, 35 insertions(+), 27 deletions(-)

diff --git a/arch/arm/mach-msm/board-semc_zeus.c b/arch/arm/mach-msm/board-semc_zeus.c
index 55c9e22..8157214 100644
--- a/arch/arm/mach-msm/board-semc_zeus.c
+++ b/arch/arm/mach-msm/board-semc_zeus.c
@@ -1324,7 +1324,8 @@ static struct as3676_platform_led as3676_pdata_leds[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 20000,
 		.default_brightness = LED_FULL,
 	},
diff --git a/arch/arm/mach-msm/leds-akane.c b/arch/arm/mach-msm/leds-akane.c
index 7cdb68b..789c3c7 100644
--- a/arch/arm/mach-msm/leds-akane.c
+++ b/arch/arm/mach-msm/leds-akane.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
diff --git a/arch/arm/mach-msm/leds-anzu.c b/arch/arm/mach-msm/leds-anzu.c
index 92da5db..1f22791 100644
--- a/arch/arm/mach-msm/leds-anzu.c
+++ b/arch/arm/mach-msm/leds-anzu.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
diff --git a/arch/arm/mach-msm/leds-azusa.c b/arch/arm/mach-msm/leds-azusa.c
index c270d5e..c7317af 100644
--- a/arch/arm/mach-msm/leds-azusa.c
+++ b/arch/arm/mach-msm/leds-azusa.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
diff --git a/arch/arm/mach-msm/leds-coconut.c b/arch/arm/mach-msm/leds-coconut.c
index b636656..74890bb 100644
--- a/arch/arm/mach-msm/leds-coconut.c
+++ b/arch/arm/mach-msm/leds-coconut.c
@@ -15,14 +15,14 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
 	{
 		.name = "button-backlight",
 		.sinks = BIT(AS3676_SINK_RGB2) | BIT(AS3676_SINK_RGB3),
-		.flags = AS3676_FLAG_ALS_GROUP2 ,
 		.max_current = 25000,
 	},
 	{
diff --git a/arch/arm/mach-msm/leds-haida.c b/arch/arm/mach-msm/leds-haida.c
index 4e716ac..9469947 100644
--- a/arch/arm/mach-msm/leds-haida.c
+++ b/arch/arm/mach-msm/leds-haida.c
@@ -15,8 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
-			| AS3676_FLAG_DLS,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
@@ -28,19 +28,19 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "red",
 		.sinks = BIT(AS3676_SINK_41),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 	{
 		.name = "green",
 		.sinks = BIT(AS3676_SINK_42),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 	{
 		.name = "blue",
 		.sinks = BIT(AS3676_SINK_43),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 };
diff --git a/arch/arm/mach-msm/leds-hallon.c b/arch/arm/mach-msm/leds-hallon.c
index b1fc986..8e96b44 100644
--- a/arch/arm/mach-msm/leds-hallon.c
+++ b/arch/arm/mach-msm/leds-hallon.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
@@ -27,19 +28,19 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "red",
 		.sinks = BIT(AS3676_SINK_41),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 	{
 		.name = "green",
 		.sinks = BIT(AS3676_SINK_42),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 	{
 		.name = "blue",
 		.sinks = BIT(AS3676_SINK_43),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 };
diff --git a/arch/arm/mach-msm/leds-iyokan.c b/arch/arm/mach-msm/leds-iyokan.c
index 075131b..259101a 100644
--- a/arch/arm/mach-msm/leds-iyokan.c
+++ b/arch/arm/mach-msm/leds-iyokan.c
@@ -15,20 +15,19 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
 	{
 		.name = "button-backlight",
 		.sinks = BIT(AS3676_SINK_RGB1),
-		.flags = AS3676_FLAG_ALS_GROUP2,
 		.max_current = 25000,
 	},
 	{
 		.name = "keyboard-backlight",
 		.sinks = BIT(AS3676_SINK_32) | BIT(AS3676_SINK_33),
-		.flags = AS3676_FLAG_ALS_GROUP2,
 		.max_current = 38000,
 	},
 	{
diff --git a/arch/arm/mach-msm/leds-mango.c b/arch/arm/mach-msm/leds-mango.c
index 9b63e34..c07ee54 100644
--- a/arch/arm/mach-msm/leds-mango.c
+++ b/arch/arm/mach-msm/leds-mango.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
@@ -29,7 +30,6 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 		.name = "keyboard-backlight",
 		.sinks = BIT(AS3676_SINK_30) | BIT(AS3676_SINK_31) |
 				BIT(AS3676_SINK_32) | BIT(AS3676_SINK_33),
-		.flags = AS3676_FLAG_ALS_GROUP2,
 		.max_current = 25000,
 	},
 	{
diff --git a/arch/arm/mach-msm/leds-mogami_cdb.c b/arch/arm/mach-msm/leds-mogami_cdb.c
index f65fd20..927ff58 100644
--- a/arch/arm/mach-msm/leds-mogami_cdb.c
+++ b/arch/arm/mach-msm/leds-mogami_cdb.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
diff --git a/arch/arm/mach-msm/leds-satsuma.c b/arch/arm/mach-msm/leds-satsuma.c
index dfc92d2..12a9221 100644
--- a/arch/arm/mach-msm/leds-satsuma.c
+++ b/arch/arm/mach-msm/leds-satsuma.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
diff --git a/arch/arm/mach-msm/leds-smultron.c b/arch/arm/mach-msm/leds-smultron.c
index c0d971d..3621108 100644
--- a/arch/arm/mach-msm/leds-smultron.c
+++ b/arch/arm/mach-msm/leds-smultron.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 25000,
 		.default_brightness = LED_FULL,
 	},
@@ -27,19 +28,19 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "red",
 		.sinks = BIT(AS3676_SINK_41),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 	{
 		.name = "green",
 		.sinks = BIT(AS3676_SINK_42),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 	{
 		.name = "blue",
 		.sinks = BIT(AS3676_SINK_43),
-		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK | AS3676_FLAG_ALS,
+		.flags = AS3676_FLAG_RGB | AS3676_FLAG_BLINK,
 		.max_current = 25000,
 	},
 };
diff --git a/arch/arm/mach-msm/leds-urushi.c b/arch/arm/mach-msm/leds-urushi.c
index 12cc76f..e4173de 100644
--- a/arch/arm/mach-msm/leds-urushi.c
+++ b/arch/arm/mach-msm/leds-urushi.c
@@ -15,7 +15,8 @@ static struct as3676_platform_led as3676_leds_mapping[] = {
 	{
 		.name = "lcd-backlight",
 		.sinks = BIT(AS3676_SINK_01),
-		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT,
+		.flags = AS3676_FLAG_PWM_CTRL | AS3676_FLAG_PWM_INIT
+			| AS3676_FLAG_WAIT_RESUME,
 		.max_current = 20000,
 		.default_brightness = LED_FULL,
 	},
-- 
1.7.10.4

